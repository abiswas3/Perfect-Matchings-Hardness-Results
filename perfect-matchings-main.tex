\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry} % Adjust margins as needed
\input{base_template}
\usepackage{accents}
\usepackage{calc}

\input{theorem}
\input{paper_commands.tex} %These are generic commands (Might move them to %base template)is
\newcommand{\Degree}[1]{\mathsf{Deg}\left(#1\right)}
\newcommand{\PerfectMatching}[1]{\mathsf{PM}\left(#1\right)}

\newcommand{\Complement}[1]{\overline{#1}}
\newcommand{\EdgeConnectivity}[1]{\kappa'(#1)}

% \newcommand{\PC}{\underset{\texttt{PC}_F}{\vdash}}
\newcommand{\PC}{\vdash_{\texttt{PC}_F}}
\newcommand{\SOS}{\vdash_{\texttt{SOS}}}
\newcommand{\en}{\textcolor{ballblue}{n}}
\newcommand{\dee}{\textcolor{cadmiumgreen}{d}}
\newcommand{\eigen}{\textcolor{red}{\lambda}}
\newcommand{\EnDeeLambda}{(n, d, \lambda)}
\newcommand{\Subdivision}[2]{{#1}^{#2}}
\newcommand{\MinimalDegree}[1]{\delta(#1)}
%\newcommand{\Indicator}[1]{\mathbbm{1}\left\{#1\right\}}
\newcommand{\dbtilde}[1]{\tilde{\raisebox{0pt}[0.85\height]{$\tilde{#1}$}}}

\newcommand{\epsilonA}{\textcolor{ballblue}{\epsilon_a}}
\newcommand{\epsilonL}{\textcolor{cadmiumgreen}{\epsilon_\lambda}}
\newcommand{\na}{\textcolor{razzmatazz}{n_A}}

\newcommand{\BipartiteG}{G_{A \cup A}}

\newcommand{\DistSet}[1]{\Delta(#1)}
\newcommand{\Dist}{\mathcal{D}}
\newcommand{\EdgesShort}{E}
%\newcommand{\Mean}[2]{\underset{#1}{\mathbb{E}}\left[#2\right]}
\newcommand{\Mean}[2]{\mathbb{E}_{#1}\left[#2\right]}
\newcommand{\Prob}[1]{\Pr\left[#1 \right]}
\newcommand{\PProb}[2]{\Pr_{#2}\left[#1 \right]}
\newcommand{\ExpansionFactor}[1]{\lambda(#1)}
\newcommand{\EmbeddingFunc}{\Psi}


\synctex=1
% Title
\title{\textcolor{definitioncolor}{Refuting Perfect Matchings In Expander Graphs Is Also Hard}}
\newcommand{\dApproxLower}{\textcolor{red}{d'}}
\newcommand{\dApproxExpandedLower}{\textcolor{black}{2\epsilon d}}
\newcommand{\dApproxExpandedUpper}{\textcolor{black}{\epsilon d + \sqrt{\nicefrac{d}{2}\log (2/\delta)}}}
%\sqrt{\nicefrac{d}{2}\log (2/\delta)} ; this is the error term

% \author{}
\author[1]{Ari Biswas}
\author[2]{Rajko Nenadov}
\affil[1]{\small University Of Warwick, United Kingdom}
\affil[2]{\small University Of Auckland, New Zealand}

% ITCS guidelines.
% Authors should register and submit their paper via the hotcrp submission site, by the above strict deadlines. The font size should be at least 11 point and the paper should be single column. Beyond these, there are no formatting requirements. Authors are required to submit a COI declaration upon submission.
% Authors should strive to make their paper accessible not only to experts in their subarea, but also to the theory community at large. The submission should include clear proofs of all central claims. In addition, it is strongly recommended that the paper contain, within the first 10 pages, a concise and clear presentation of the merits of the paper, including a discussion of its significance, innovations, and place within (or outside) of our field's scope and literature. The committee will put a premium on writing that conveys clearly, in as simple and straightforward a manner as possible, what the paper accomplishes.
\date{}
% \linenumbers
\begin{document}

\maketitle
\begin{abstract}
Todo
\end{abstract}

\section{Introduction}


\begin{theorem}{Main Result}{thm:main-thm}
There is a constant $d_0 \in \Naturals$ such that for all $d \geq d_0$, the following holds asymptotically almost surely for any $(n, d, \lambda)$-graph $G$ on $n$ vertices, where $n$ is odd and $\lambda < ??$:
\begin{enumerate}
    \item{ $\Degree{\PerfectMatching{G} \PC \bot} = \BigOmega{\nicefrac{n}{\log n}}$} 
    \item{$\Degree{\PerfectMatching{G} \SOS \bot} = \BigOmega{\nicefrac{n}{\log n}}$}
    \item \highlight{add in the frege}
\end{enumerate}


\highlight{Figure out what the condition must be on $\lambda$}
\end{theorem}


\section{Technical Overview}

Put in proof by pictures here.



\section{Preliminaries}

\paragraph{Notation} Sets are denoted with upper case normal font e.g., $S$. Families (or collections) of sets are denoted with upper case calligraphic purple text e.g., $\Family{S}$. 


\begin{definition}[Dependency Graphs]\label{def:dep-graphs}
	
\end{definition}

\begin{lemma}[Lov\`asz Local Lemma]\label{lemma:lll}Let $\Dist \in \DistSet{\bit^*}$ be a discrete probability distribution.
Let $E_1,...,E_n$ be a set of events, and assume that the following hold: (1) The degree of the dependency graph given by $(E_1, \dots, E_n)$ is bounded by $d$, and (2) $\PProb{E_i}{\Dist} \leq \beta$ for some $\beta \leq \frac{1}{4d}$. Then,

\[ \PProb{\overset{n}{ \underset{i=1}{\cap}} \hspace{0.1cm}  \overline{E_i}}{\Dist} > 0\]	
	
\end{lemma}

\subsection{Proof Complexity Preliminaries}

\begin{definition}[Polynomial Calculus Refutations]\label{def:poly-calc-refutations}
	
\end{definition}

\subsection{Graph Theory Preliminaries}

For a graph $\Graph$, we use $\Vertices{\Graph}$ and $\Edges{\Graph}$ to denote the vertices and edges of $\Graph$. 
For any $E' \subseteq \Edges{\Graph}$ and a vertex $v \in \Vertices{\Graph}$, we use $\Neighbourhood{E'}{v} = \{ u \in \Vertices{\Graph} : (u,v) \in E' \}$ to denote the neighbourhood of $v$ with respect to $E'$, and $\degree{E'}{v}$ to denote the number of vertices adjacent to $v$ via edges in $E'$.

\begin{definition}[Subgraph]\label{def:subgraph}
A graph $G'=(V', E')$ is a subgraph of another graph $G=(V, E)$ iff (1) $V'\subseteq V$, and (2) $E'\subseteq E$ and  $(v1, v2) \in E' \implies (v1, v2) \in V')$.
	
\end{definition}

\begin{definition}[Sub-divisions]\label{def:subdivisions}
Given a graph $H$ and a function $\sigma: \Edges{H} \rightarrow \Naturals$, the $\sigma$-subdivision $H$, denoted by $\Subdivision{H}{\sigma}$, is the graph obtained by replacing each edge in $\Edges{H}$ with a path of length $\sigma(e)$ joining the end points of $e$ (such that all these paths are mutually vertex disjoint, except at the end points).	
\end{definition}

\begin{definition}[Topological Minor]\label{def:topological-minor}
A graph $H$ is a topological minor of a graph $G$ if there exists a subdivision $\Subdivision{H}{\sigma}$ that is isomorphic to \emph{any} subgraph of $G$.	
\end{definition}

Next we define pseudorandom graphs or expander graphs. 
Throughout this document, it suffices to treat $d$ as a small constant.

\begin{definition}[$\EnDeeLambda$ pseudorandom graphs]\label{def:expander-graphs}
Let $G$ be a $d$-regular graph on $n$ vertices, and, let $\lambda_1 \geq \lambda_2, \dots, \geq \lambda_n$ denote eigenvalues of the adjacency matrix of $G$.
We say $G$ is an $\EnDeeLambda$-graph if $\ExpansionFactor{\Graph} \Def \underset{{\{2, \dots, n\}}}{\max}|\lambda_i| \leq \lambda$.
\end{definition}


\begin{lemma}[Expander Mixing Lemma]\label{lemma:expanders-mixing-lemma}
	
\end{lemma}


\section{Embedding Machinery}

The following definitions are adapted from \citep{nenadov2023routing} but were originally introduced by \citet{feldman1988wide} in their work about the theory of wide sense blocking networks.

\begin{definition}[$(p, q)$-non blocking bipartite graphs \citep{nenadov2023routing}]
Given $p,q \in \Naturals$ , we say that a bipartite graph $\Graph = (A \cup B, E)$ is $(p, q)$ \emph{non-blocking}, if there exists a family $\Family{S}$ of subsets of $E$, called the \emph{safe states}, such that the following holds:

\begin{enumerate}
	\item $\emptyset \in \Family{S}$
	\item If $E'' \subseteq E'$ and $E' \in \Family{S}$, \emph{then}, $E'' \in \Family{S}$.
	\item Given $E' \in \Family{S}$ such that $|E'| \leq p$, and \emph{any} $v \in A$ with $\degree{E'}{v} < q$, there exists $e = (v, w) \in E \setminus E'$  such that (i) $E' \cup \Set{e} \in \SafeStates $, and (ii) $w$ is not incident to any edge in $E'$ i.e. $\forall x \in A$ we have $(x,w) \notin E'$. 
 We call $w$ a \emph{safe neighbour} for $v$ given $E'$.
\end{enumerate}

\end{definition}


\paragraph{Why are non-blocking graphs useful} 
\ari{Use the get out of jail analysis I wrote down.}\par
\begin{figure}[h]
\center
{\caption{A test figure with its caption side by side}\label{fig:test}}
{\includegraphics{assets/non-blocking-networks.pdf}}
\end{figure}

Next, we re-state a lemma by \citep[Proposition 1]{feldman1988wide} which describes the properties bipartite graphs must satisfy to be non-blocking.

\begin{lemma}\label{lemma:condtions-for-non-block}
Fix $a, r, s \in \Naturals$. Let $\Graph = (A \cup B, E)$ be a bipartite graph.
If for every $X \subseteq A$ of size $1 \leq |X| \leq 2a$, there are \emph{at least} $(r + s)|X|$ vertices in $B$ that are adjacent to $A$, \emph{then}, $\Graph$ is $(r, as)$-non blocking.
\end{lemma}


\section{Proof Of Main Result}

Let $G=(V,E)$ denote any $\EnDeeLambda$-graph on an odd number of vertices, and,  $\HardInstance$ denote the hard instance on $t$ vertices for polynomial calculus, as described by \citet{buss1999linear}, where the refutal certificate is of degree $\BigOmega{t}$.
The hardness proof follows from the following steps:


\begin{enumerate}
	\item First, we show (via Lemma \ref{lemma:partition}) that we can partition the vertices of the graph $\Graph$ into two disjoint sets $A$ and $B$, as shown in Figure \ref{subfig:partitionA}. The partition has the property that for each vertex $v \in V$, it has roughly $\epsilon d$ neighbours inside $A$ i.e. $|\Neighbourhood{E}{v} \cap A| \approx \epsilon d$, where $\epsilon$ is a small enough constant. Given this partitioning, we define consider the subgraph $G_A = (A, E_A)$ where we only include edges with both endpoints in $A$ (see Figure \ref{subfig:partitionB}).
	\item Secondly, we find a subdivision $\Subdivision{H}{\sigma}$ of $H$, where for each $e \in \Edges{H}$, we have $\sigma(e) = \PathSize$ for $l = \lceil 1/2\log_{D}n\rceil$ and $\PathSize$ is an odd integer (can be expressed as $\PathSize = 2k+1$ for some $k \in \Naturals$. We show (via Lemma \ref{lemma:top-embedding}) that $\Subdivision{H}{\sigma}$ is a subgraph of $G_A$ defined above. \ari{Add in the alternating argument.}
	
%	\item Successfully executing the above steps guarantees that $\HardInstance$ exists inside of $\Graph$ as a topological minor. But as described earlier, this does not suffice in showing that $\PerfectMatching{\Graph}$ is also hard to refute. Let $\Embedding{\HardInstance}$ denote the vertices that form the topological embedding of $\HardInstance$ in $\Graph$. We want to show that the induced subgraph $\Graph[\Vertices{\Graph} \setminus \Embedding{\HardInstance}]$ contains a perfect matching. 
	\item We show (via Lemma \ref{lemma:perfect-matching}) that the subgraph of $G$ not participating in the topological embedding above, has a perfect matching $M$. For all $e \in M$, we set $x_e = 1$ and for all $e \notin \Edges{\Embedding{\Subdivision{H}{\sigma}}}$ but not in $M$, set $x_e = 0$. These assignments imply that the formula for refuting $\PerfectMatching{G}$ can be partially filled up, and we are left with the task of refuting a restricted formula. Refuting this restricted formula is identical to finding a refutation in the original hard instance, and thus the proof complexity for refuting perfect matching for $G$ is $\BigOmega{t}$ where $t$ is the number of vertices in the hard instance $H$. We show that $t = \BigOmega{n\log n}$.
\end{enumerate}

\subsection{Step 1: Partition $G$ into $A$ and $B$}

\begin{lemma}[Multiplicative Chernoff Bound]\label{lemma:mult-chernoff}
Suppose $X_1, ..., X_n$ are independent random variables taking values in $\{0, 1\}$. Let $X$ denote their sum and let $\mu = n\Mean{}{X_i}$ denote the sum's expected value. Then for any $0 < \delta < 1$

\[ \Prob{|X - \mu| \geq \delta \mu} \leq 2\exp(-\delta^2\mu/3)\]
	
\end{lemma}

%\begin{figure*}[t!]
%    \centering
%    \begin{subfigure}[t]{0.5\textwidth}
%        \centering
%        \includegraphics{assets/ParitionA.pdf}
%        \caption{The figure above describes the partitioning of the vertices of the graph $G$ into two sets $A$ and $B$, such that for every vertex $v \in \Vertices{G}$, $\epsilon d$ fraction of the edges go into $A$ (depicted in orange) and $1 - \epsilon d$ fraction of the edges go into $B$.}
%    \end{subfigure}%
%    ~ 
%    \begin{subfigure}[t]{0.5\textwidth}
%        \centering
%        \includegraphics{assets/PartitionB.pdf}
%        \caption{The figures on top describes the subgraph $G_A$ obtained by including vertices in $A$, and only edges that stay inside $A$ (orange edges). The figure below describes how we construct a bipartite graph $\BipartiteG$ from $G_A$.}
%    \end{subfigure}
%%    \caption{Caption place holder}
%\end{figure*}

\begin{figure*}[t!]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{assets/ParitionA.pdf}
        \caption{The figure above describes the partitioning of the vertices of the graph $G$ into two sets $A$ (highlighted in green) and $B$ (highlighted in blue), such that for every vertex $v \in \Vertices{G}$, $\epsilon d$ fraction of the edges go into $A$ (depicted in orange) and $1 - \epsilon d$ fraction of the edges go into $B$.}
        \label{subfig:partitionA}
    \end{subfigure}%
    \hspace{1mm}
    \vrule width 1pt % vertical line
    \hspace{1mm}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{assets/PartitionB.pdf}
        \caption{The figures on top describes the subgraph $G_A$ obtained by including vertices in $A$ and edges that stay inside $A$ (orange edges), as described in the construction of Step 2. The figure below describes the bipartite graph $\BipartiteG$ we use for the embedding theorem.}
        \label{subfig:partitionB}        
    \end{subfigure}
\end{figure*}


\begin{theorem}{Partition Theorem}{partition}
Let $\alpha = 0.1$ to be a small constant.
Given a $\EnDeeLambda$ graph $\Graph = (V, E)$, there exists a small constant $\delta \in (0,1)$ and a partition of $V$ into disjoint sets $A$ and $B$, such that, we have for every $v \in V$, $ d\alpha(1-\delta)\leq |\Neighbourhood{\EdgesShort}{v} \cap A| \leq d\alpha(1+\delta)$.

	
\end{theorem}

\begin{proof}We prove the existence of such a partition $A \cup B = V$ using the probabilistic method.
For each $v \in \Vertices{\Graph}$, we toss an independent coin $X_i$ with bias $\alpha$.
If $X_i = 1$, then we include $v$ in $A$, else we put $v$ in $B$.
Thus, $\vec{X} \Def (X_1, \dots, X_n) \in \bit^n$ is a random variable that describes how we partition $V$ into sets $A$ and $B$.
For any $v \in V$, let $Y_v = |\Neighbourhood{\EdgesShort}{v} \cap A| = \sum_{x \in \Neighbourhood{E}{v}} \Indicator{x \in A}$ denote the random variable that counts how many neighbours of $v$ are also in $A$.\\
For any $\delta \in (0,1)$ and for any $v \in V$, let $E_v = \Indicator{|Y_v - d\alpha | \geq \delta \alpha d}$ denote the bad event that $Y_v$ is bounded away from $\alpha d$ by a multiplicative factor of $\delta$.
As $\Graph$ is $d$-regular, $\Mean{\vec{X}}{Y_v} = \alpha d$, and observe that the dependency graph (Definition \ref{def:dep-graphs}) of events $\{ E_v \}_{v \in V}$ has max-degree at most $d$.
By the multiplicative Chernoff bound (Lemma \ref{lemma:mult-chernoff}), for any $v \in V$, we have $\PProb{E_v}{\vec{X}} \leq 2\exp(-\delta^2\alpha d/3) \Def \beta$.
We can make $\delta \in (0,1)$ large enough, such that $2\exp(-\delta^2\alpha d/3) \leq 1/(4d)$. Therefore, we have $\beta d \leq 1/4$.
Thus, we can invoke the Lov\`asz Local Lemma (Lemma \ref{lemma:lll}) to get $\PProb{\forall v \in V, \text{ } E_v = 0}{\vec{X}} > 0$

\end{proof}

%Let $\tilde{\Graph} = A \cup B$ be the bipartite graph defined in the construction of Lemma \ref{lemma: bipartite-construct-non-block}.
%We know that this graph $(\pee, \qu)$ is non-blocking.
%Let $(a_1, \dots, a_k)$ denote an arbitrary ordering of arbitrary vertices in $A$.
%Set $E' = \emptyset$. 
%As $\tilde{\Graph}$ is non-blocking, there exists a collection of \emph{safe states} $\SafeStates$.


\subsection{Step 2: The Topological Embedding}

\ari{Revisit this again.}
Given $\EnDeeLambda$ graph $G=(V,E)$, let $A$ and $B$ be the partition guaranteed by the \ \nameref{theorem:partition}.
We also have that for all $v \in A$,  $|\Neighbourhood{\EdgesShort}{v} \cap A| \leq d \alpha(1+\delta) = \Eps d$, where $\Eps = (1+ \delta)\alpha$ and $\alpha, \delta \in (0,1)$ are constants as defined in the \nameref{theorem:partition}.
Define $\dApproxLower \Def \Eps d$.
Define $E_A \Def \{ (u,v) \in E : u \in A \land v \in A\}$. 
That is $E_A$ are the edges whose endpoints are fully contained in A (orange edges in Figure \ref{subfig:partitionA}), and $G_A = (A, E_A)$. 
Define $ \na = |A|$.
Now define a bipartite graph $\BipartiteG = (V_A \cup V_A)$ such that if $(u,v) \in E_A$, then $(u,v) \in \Edges{\BipartiteG}$.
As $G$ is an $\EnDeeLambda$ graph, we have that $\BipartiteG$ is a $(\na, \dApproxLower, \lambda)$ graph.

\ari{This is wrong; I need to be more direct. Can't use expansion directly}
\begin{lemma}\label{lemma:bipartitie-is-non-blocking}Let $G$ be the $\EnDeeLambda$ graph given to us and let $\BipartiteG$ be the bipartite graph described above. 
%Let $\epsilon$ be the small constant from Lemma \ref{lemma:partition}.
%Define $\dApproxLower = \dApproxExpandedLower$.
There exists $\epsilonL, \epsilonA  \in (0,1)$ small enough, such that if $\lambda < \epsilonL \dApproxLower$, then $\BipartiteG$ is $(\frac{\dApproxLower}{\lambda}, \epsilonA\na)$ non-blocking.
\end{lemma}

\begin{proof}
Let $X$ and $Y$ denote the left and right vertices of the bipartite graph $\BipartiteG$.
Define $a = \epsilonA\cdot\frac{\lambda \na}{\dApproxLower}$.
Fix $S \subseteq X$ such that $1 \leq |S| \leq 2a$.
Suppose towards a contradiction, $G_A$ is \emph{not} non-blocking.
Then by Lemma \ref{lemma:condtions-for-non-block}, for all $T \subseteq Y$, $\EdgesAccross{S, T}{E_A} \leq (2\dApproxLower/\lambda)|S|$.
Pick $T^* \subseteq Y$ such that 

\begin{equation}
\EdgesAccross{S, T^*}{E_A} \geq |S|\dApproxLower	 \label{eq:lots-edges}
\end{equation}

We know $T^*$ exists as $G_A$ is $\dApproxLower$ regular.
From the expander mixing lemma \ref{lemma:expanders-mixing-lemma},

\begin{align}
	\EdgesAccross{S, T^*}{E_A} &\leq \frac{\dApproxLower}{\na}|S||T^*| + \lambda\sqrt{|S||T^*|} \\
	&\leq \frac{\dApproxLower^2}{\na \lambda}|S|^2 + |S|\sqrt{2\lambda \dApproxLower} \label{eq:stepa}\\
	&< \frac{\dApproxLower^2}{\na \lambda}|S|^2 + |S|\dApproxLower\sqrt{2\epsilonL } \label{eq:stepb}\\
	&\leq |S|\dApproxLower\left[ \frac{\dApproxLower|S|}{\na\lambda} + \sqrt{2\epsilonL}\right] \\
	&\leq |S|\dApproxLower\left[ \frac{\epsilonA}{2} + \sqrt{2\epsilonL}\right] \label{eq:stepc}
\end{align}


For Equation \eqref{eq:stepa} We use that $\EdgesAccross{S, T^*}{E_A} \leq (2\dApproxLower/\lambda)|S|$. For Equation \eqref{eq:stepb} we use $\lambda < \epsilonL\dApproxLower$. For Equation \eqref{eq:stepc} we use $|S| \leq 2a$.
Setting $\epsilonA$ and $\epsilonL$ small enough such that  $\frac{\epsilonA}{2} + \sqrt{2\epsilonL} < 1$, we get a contradiction with Equation \eqref{eq:lots-edges}.

\end{proof}


The next step is to topologically embed hard instance $H$ into the subgraph $G_A = (A, E_A)$.
Note for every edge in $G_A$, by our construction, we will have a corresponding edge in the bipartite graph $\BipartiteG$.

\begin{theorem}{Topological Embedding}{top-embedding}
Let $G$ be a $\EnDeeLambda$ graph, and $\BipartiteG$ be the construction defined above, where $|A| = \na$.
Let $\dApproxLower \Def \Eps d$, and $H$ be the worst case hard instance on $t = \lceil\epsilonA \frac{\na}{\log \na}\rceil$ vertices, where $0 < \epsilonL < \epsilonA <1$ are the constants from  Lemma \ref{lemma:bipartitie-is-non-blocking}.	
\ari{Define $\sigma$}.
If $\lambda \leq \frac{\epsilonL\dApproxLower}{\log_D[\na]}$, then $G$ contains $\Subdivision{H}{\sigma}$ as a subgraph.

\end{theorem}



\begin{proof}
Define $D = \frac{\dApproxLower}{\lambda} = \frac{2\epsilon d}{\lambda}$ and $k \Def \lceil\log_D\na\rceil$.
Let $\{ h_1, \dots, h_t\}$ denote the vertices of $H$.
Let $\EmbeddingFunc: \Vertices{\Subdivision{H}{\sigma}} \rightarrow \Vertices{G_A}$ be the bijective mapping between the vertices of $\Subdivision{H}{\sigma}$, and the vertices of $G_A$, that defines our topological embedding.
Our first task is to find a unique $\Embedding{h} \in \Vertices{G_A}$ for each $h \in \Vertices{H}$.
Let $\{a_1, \dots, a_{t}\}$ be arbitrary set of $t$ vertices in $\Vertices{G_A}$.
We repeat the following process to obtain $\{ \Embedding{h_1}, \dots, \Embedding{h_t}\}$.
Let $X=\Vertices{G_A}$ and $Y=\Vertices{G_A}$ denote the left and right sides of the bipartite graph $\BipartiteG$ described above.
\ari{Add in some intuition as to why we need to do this}

\begin{figure*}[t!]
    \centering
    \begin{subfigure}[t]{0.95\textwidth}
        \centering
        \includegraphics{assets/embeddingA.pdf}
        \caption{The \textcolor{purple}{purple} edges represent the edges in $\cup_{i=1}^j (M_j \cup M_j')$, which we have already included.
        For any $v$ in $S_j \subseteq X$ (\textcolor{cadmiumgreen}{green vertex}) we ask for $D$ neighbours in $S_{j+1} \subseteq Y$ (shown with \textcolor{cadmiumgreen}{green} and \textcolor{carminepink}{pink} lines). 
        Of these $D$ edges, by the non-blocking property, we know that there will be at least one edge (in this case there are 3 such edges shown in \textcolor{carminepink}{pink}) such that the endpoints in $Y$ are not connected to any of the \textcolor{purple}{purple} edges. The \textcolor{cadmiumgreen}{green} dotted edges are connected to vertices that are already incident by one of the \textcolor{purple}{purple} edges, and so we cannot use them. We will add the \textcolor{carminepink}{pink} edges will be added to $M_j$.}
        \label{subfig:embeddingA}
    \end{subfigure}%
    \hspace{1mm}
%    \vrule width 1pt % vertical line
    \hspace{1mm}
    \begin{subfigure}[t]{0.95\textwidth}
        \centering
        \includegraphics[]{assets/embeddingB.pdf}
        \caption{We restrict the size of $M_j$ to be $\min\{t, |S_{j-1}|D\}$ edges. As $k = \log_{D}[\na]$, eventually, for some $j \leq k$, we get $t \leq |S_{j-1}|D$.
        In the above example $M_{j-1}$ has size $D|S_{j-2}|$ but $M_j$ has size $t$. 
        From then on for all $j \leq i \leq k$, $|M_i|= t$.
        Furthermore, for $j \leq i \leq k$,  each vertex in $S_i$ will be connected to exactly one vertex in $S_{i+1}$.
        }
        \label{subfig:embeddingB}        
    \end{subfigure}
\end{figure*}


\begin{itemize}
	\item Define $E' = \emptyset$ to begin with.
	\item For $a_1 \in X$, ask for $D$ neighbours in $Y$. As $|E'| = 0 \leq \epsilonA \na$, and $\BipartiteG$ is $(D, \epsilonA \na)$ non-blocking, we can find a \emph{safe neighbour} $\tilde{h}_1 \in Y$ such that there is no edge in $|E'|$ is incident on $\tilde{h}_1$. We set $\Embedding{a_1} = \tilde{h}_1$ and update $E' = E'  \cup \{(a_1, \tilde{h}_1)\}$.
	\item We repeat this process for all $a \in \{a_2, \dots, a_t\}$. As $|E'| \leq t < \epsilonA\na$, for each $a_j$ we can always find a $\tilde{h}_j$ in $Y$ such that there is an edge $(a_j, \tilde{h}_j)$, and there is no other edge in $E'$ that is incident on each $\tilde{h}_j$.
\end{itemize}

Once this phase is complete, we have mapped every vertex of $H$ to a vertex in $G_A$.
The next step to show that for each $(u,v) \in \Edges{H}$, there is a vertex disjoint path of odd length $\PathSize = 2k+1$ between $\Embedding{u}$ and $\Embedding{v}$ in $G_A$.
Let $(e_1, \dots, e_m)$ be an arbitrary ordering of edges in $\Edges{H}$.
We prove the result by induction on $m$.

\paragraph{Base case} 

Let $e_1 = (u,v)$. Define sets $S_0 = \{\Embedding{u}\}$ and $\tilde{S}_0 = \{ \Embedding{v}\}$, and set $M_0 = \emptyset$ and $M_0' = \emptyset$.
For each $z=1, \dots, k$, we will define edge sets $\{ M_j\}_{j \in [k]}$ and $ \{ M'_j\}_{j \in [k]}$, and vertex sets $\{ S_j\}_{j \in [k]}$ and $\{ S'_j\}_{j \in [k]}$ inductively as follows:

\begin{tcolorbox}
Fix $ 1 \leq z \leq k$, iteratively, let $M_z$ and $M'_z$ be the sets of $|S_z| \Def \min\{t, |S_{z-1}|D\}$ edges in $E_A$ incident to $S_{z-1}$ and $S_{z-1}'$ respectively, such that each vertex in $Y$ is incident to \emph{at most} one edge in $\cup_{i=1}^{z} (M_i \cup M'_i)$.\\
More concretely, fix $1 \leq z \leq k$, and for each $v \in S_z \subseteq X$, we ask for $D$ neighbours in $S_{j+1} \subseteq Y$ via edges in $E_A$.
As $\BipartiteG$ is $(D, \epsilonA \na)$ non blocking, we know that at least one of these edges will be a safe edge connecting us to a safe neighbour in $Y$.
Figure \ref{subfig:embeddingA} illustrates this.\\
If there are more than one such edges for the vertices in $S_j$, consider at least one edge per vertex $v \in S_j$ to add to $M_j$ and, make sure $|M_j| = \min\{t, |S_{j-1}|D\}$.
Figure \ref{subfig:embeddingB} illustrates this idea.
$M'_j$ and $S_j'$ are constructed analogously.
\end{tcolorbox}

Let $M = \cup_{i=1}^k (M_i \cup M'_i)$.
The reason we can always construct the sets described above sets is that $|M| \leq t < \epsilonA\na$, and as $\BipartiteG$ is $(D, \epsilonA\na)$ non-blocking, for any vertex $x \in S_j \subseteq X$, with at most $D$ neighbours in $S_{j+1} \subseteq Y$, we can always find \emph{at least} one $y \in Y$, such that $(x,y) \in E_A$ and no edge in $\cup_{i=1}^{j-1} (M_i \cup M'_i)$ is incident on $y$.
Now as $k = \log_D[\na]$, we have that, $|S_k| = |S_k'|= t$.
By the expander mixing lemma \ref{lemma:expanders-mixing-lemma},

\begin{align}
	\EdgesAccross{S_k, S_k'}{E_A} &\geq \frac{\dApproxLower t^2}{\na} - \lambda t \\
	&= \frac{\na\epsilonA}{\log_D[\na]}\left[\frac{\epsilonA\dApproxLower}{\log_D[\na]} - \lambda \right]\\
	&> 0 \label{eq:greater}
\end{align}

Equation \eqref{eq:greater} comes from the assumption $\lambda \leq \frac{\epsilonL\dApproxLower}{\log_D[\na]} < \frac{\epsilonA\dApproxLower}{\log_D[\na]}$.\\
\ari{Can this requirement be relaxed or is it inherent in our analysis?}

This implies there exists at least one edge $e=(x,y)$ between $S_k$ and $S_k'$.
By how we constructed $M_k$, we know there is an edge $m_k = (a,x) \in M_k$ connecting $x$ to some vertex $a$ in $S_{k-1}$. We repeat this process all the way, till we get $k+1$ edges, $m_1 m_2 \dots, m_k e$.
We repeat the same process for the other end point of $y \in S_k'$, to get edges $m'_1, \dots, m'_k$.
We add these edges to $E'$ as well. 
This gives is the situation depicted in Figure \ref{fig:baseB}.
Thus, we have found an odd length path $m_1\dots m_k e m_1'\dots m_k'$ of length $2k+1$, connecting $\Embedding{u}$ to $\Embedding{v}$.

\begin{figure}
	\includegraphics[width=0.9\textwidth
	]{assets/BaseA.pdf}
	\caption{The figure on top describes the forward phase of finding sets $\{M_i\}_{i\in [k]}$ and $\{M_i'\}_{i\in [k]}$. The figure on top describes the process of backtracking from the edge $e$ that is promised to exist between $S_k$ and $S_k'$.}
	\label{fig:baseB}
\end{figure}



\paragraph{Induction Step}
	
Assume that we have found paths for $e_1 = (u_1, v_1), \dots, e_j=(u_j, v_j)$ for $j < m$.
Let $P_1, \dots, P_j$ denote these paths (depicted with \textcolor{carminepink}{pink} edges in Figure \ref{fig:induction}) .
Let $E'$ denote the set of all edges in these paths.
Let $e_{j+1} = (u,v) \in \Edges{H}$.
Set $S_0 = \{u_1, \dots, u_j\}$ and $S_0' = \{v_1, \dots, v_j\}$
Note that $|E'| \leq tk \leq \epsilonA \na$.
The process for finding a path between $u_{j+1}$ and $v_{j+1}$ reduces the base case, where now for any $1 \leq i \leq k$, for each node in $S_i$ and $S_i'$ we find a safe neighbour that does not have an incident  edge from $E' \cup (\cup_{i=1}^k (M_i \cup M'_i))$. As $|M| < \epsilonA\na$ as well, we are guaranteed safe neighbours exist for each node (depicted with \textcolor{purple}{purple} edges in Figure \ref{fig:induction})).
This concludes the proof.

\begin{figure}
	\includegraphics[width=0.9\textwidth
	]{assets/InductionStep.pdf}
	\caption{The figure above describes the induction step. The nodes in green are already in the embedding and represent paths $P_1, \dots, P_j$ for edges $(u_1, v_1) \dots, (u_j, v_j)$.
	The nodes in yellow represent candidates for the path for edge $u_{j+1}, v_{j+1}$. 
	The candidate nodes are constructed identical to the procedure described in the base step of the induction step, where we use the non-blocking property of $\BipartiteG$ to extend with safe neighbours. 
	}
	\label{fig:induction}
\end{figure}

	
\end{proof}

\subsection{Step 3: Finding A Perfect Matching In The Remainder Of The Graph}

\begin{definition}[Edge Connectivity]\label{def:edge-connectivity}
The edge connectivity of a graph $G$, denoted with $\EdgeConnectivity{G}$ is the minimum number of edges we must delete from the graph to make it disconnected.	
\end{definition}

%Lemma \ref{lemma:expanders-minimal-matching} is from \citep[Theorem 4.3]{krivelevich2006pseudo}, that says the pseudorandom graphs on an even number of vertices have perfect matchings.


\ari{Add subgraph notation}
\begin{lemma}[Tutte Criterion]\label{lemma:tutte-criterion}
Let $\OddComponents{G}$ denote the number of odd components in a graph $G=(V,E)$. 
$G$ admits a perfect matching \emph{if and only if} for every $S \subseteq V$, $\OddComponents{G[V \setminus S]} \leq |S|$.
\end{lemma}


\begin{lemma}\label{lemma:perfect-matching}
Given $\EnDeeLambda$ graph $\Graph=(V,E)$, let $\Embedding{\Subdivision{H}{\sigma}}$ be the topological embedding of the hard instance $H$ from the \nameref{theorem:top-embedding}.
There exits a small constant $\PartitionEps \in (0,1)$, such that 
if $\ExpansionFactor{G} \leq d - \PartitionEps d - 2$, then the sub-graph $\Graph[V \setminus \Embedding{\Subdivision{H}{\sigma}}]$ has a perfect matching.	
\end{lemma}

\begin{proof}
Let $\PartitionEps = 2\Eps$, where $\Eps$ is as defined above.
Define $\tilde{d} = d - \Eps d =d - \frac{d\PartitionEps}{2}$ and let $\tilde{G}=(\tilde{V}, \tilde{E})$ be short hand for $\Graph[V \setminus \Embedding{\Subdivision{H}{\sigma}}]$.
Assume that the edge connectivity of $\tilde{G}$, denoted by $\EdgeConnectivity{\tilde{G}}$, is $\tilde{d}$. 
%Then we show using the Tutte criterion that $\tilde{G}$ admits a perfect matching.
Pick arbitrary $S \subseteq \Vertices{\tilde{G}}$.
By the guarantees of the  \nameref{theorem:partition}, 
the minimal degree of $\tilde{G}$ is $\tilde{d}$. 
Therefore, the number of edges in the cut between $S$ and $\Complement{S}$ is at most $\tilde{d}|S|$.
If $\EdgeConnectivity{\tilde{G}} = \tilde{d}$, then by a simple counting argument, it must be that $\OddComponents{\tilde{G}[\tilde{V} \setminus S]} \leq |S|$ (as we need to delete  at least $\tilde{d}$ edges in the cut to disconnect the graph).
Thus, by Lemma \ref{lemma:tutte-criterion}, $\tilde{G}$ admits a perfect matching.

To complete the proof we need to show that $\EdgeConnectivity{\tilde{G}} = \tilde{d}$.
Let $\tilde{n} \Def |\tilde{V}|$.
Pick arbitrary $U \subset \tilde{V} \subset V$ such that $|U| \Def u \leq \tilde{n}/2 \leq n/2$.
As $G$ is an $\EnDeeLambda$ graph, we have

\begin{align}
\CutEdges{U}{\Complement{U}}{E} &\geq 	\frac{d}{n}u(n-u) - \lambda\sqrt{u(n-u)(1 - u/n)(1- (n-u)/n)} \label{eq:step1}\\
&= \frac{(n-u)}{u}u(d - \ExpansionFactor{G}) \label{eq:step2}\\
&\geq \frac{u}{2}(d - \ExpansionFactor{G})
\end{align}

\eqref{eq:step1} comes from the tighter version of the expander mixing lemma (Lemma \ref{lemma:expanders-mixing-lemma}), and 
\eqref{eq:step2} comes from the fact $u \leq n/2$.
To construct $\tilde{G}$, we delete at most $\Eps$ fraction of edges for each vertex $v \in V$, such that the degree of every vertex $v \in \tilde{V}$ is at least $\tilde{d}$.
Therefore, the number of edges across $U$ and $\Complement{U}$ based on $E$ we might have to delete to construct $\tilde{G}$ is at most $u(\PartitionEps d)/2$.

\begin{align}
	\CutEdges{U}{\Complement{U}}{\tilde{E}} &\geq 	\CutEdges{U}{\Complement{U}}{\tilde{E}} - \frac{\PartitionEps d}{2} u \\
&\geq \frac{u}{2}(d - \ExpansionFactor{G}) - \frac{\PartitionEps d}{2} u \\
&= \frac{u}{2}\left(d - \ExpansionFactor{G} - \PartitionEps d\right) \label{eq:lambda-assumption} \\
&\geq \tilde{d}
\end{align}


\eqref{eq:lambda-assumption} comes from the assumption that $\ExpansionFactor{G} \leq d - \PartitionEps d - 2$, which is easily satisfied by the conditions on $\ExpansionFactor{G}$ in the above lemmas.
%be an arbitrary subset of size at most $\tilde{n}/2$.\ari{Make sure to define $\tilde{n}$}.

%Let $\Embedding{\Subdivision{H}{\sigma}}$ denote the subgraph of $G$ which represents the topological embedding of $H$ from Lemma \ref{lemma:top-embedding}.
%Define . 
%That is $\tilde{\Graph}$ is a subgraph of $\Graph$ using all vertices in $B$ and the vertices in $A$ that were not used to embed $\Subdivision{H}{\sigma}$.
%As $\ExpansionFactor{\Graph} \leq \lambda$, and $\tilde{\Graph}$ is a subgraph, we have $\ExpansionFactor{\tilde{\Graph}} \leq \lambda$.
%%\ari{This is super easy to show using basic linear algebra, I can explicitly prove this if you think it's needed.}
%By lemma \ref{lemma:partition}, we know that the minimal degree $\MinimalDegree{\tilde{\Graph}} \geq \tilde{d}$.
%Let $\dbtilde{\Graph}$ denote a subgraph of $\tilde{G}$, where for each $v \in \Vertices{\tilde{\Graph}}$ we retain exactly $\tilde{d}$ of its neighbours.
%It is easy to see that $\dbtilde{\Graph}$ is a $(\tilde{n}, \tilde{d}, \lambda)$ pseudorandom graph, where $\tilde{n} = |\Vertices{\tilde{\Graph}}|$ and $n$ is even (since $|\Vertices{\Graph}|$ is odd and $|\Vertices{\Embedding{\Subdivision{H}{\sigma}}}|$ is also odd). 
%As $\lambda \leq \tilde{d} - 2$, we invoke Lemma \ref{lemma:expanders-minimal-matching} to get that $\dbtilde{G}$ has a perfect matching.
%As $\dbtilde{G}$ is a sub-graph of $\tilde{G}$ with the same vertex set, $\tilde{G}$ also has a perfect matching.
%\ari{Set $\lambda$ here from the embedding lemma and you're done}.
\end{proof}

\section{Related Work}

\clearpage
\bibliographystyle{abbrvnat}
\bibliography{main_paper}
\end{document}
