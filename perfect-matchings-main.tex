\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry} % Adjust margins as needed
\input{base_template}
\usepackage{accents}
\usepackage{calc}
\input{theorem}
\input{paper_commands.tex} %These are generic commands (Might move them to %base template)is

% Intro
%\newcommand{\P}{\mathsf{P}}
%\newcommand{\NP}{\mathsf{NP}}

\synctex=1
% Title
\title{Sum of Squares Refutations of Perfect Matchings In Expander Graphs Is Hard}
\newcommand{\dApproxLower}{\textcolor{red}{d'}}
\newcommand{\dApproxExpandedLower}{\textcolor{black}{2\epsilon d}}
\newcommand{\dApproxExpandedUpper}{\textcolor{black}{\epsilon d + \sqrt{\nicefrac{d}{2}\log (2/\delta)}}}
%\sqrt{\nicefrac{d}{2}\log (2/\delta)} ; this is the error term

% \author{}
\author[1]{Ari Biswas}
\author[2]{Rajko Nenadov}
\affil[1]{\small University Of Warwick, United Kingdom}
\affil[2]{\small University Of Auckland, New Zealand}

\date{}
% \linenumbers
\begin{document}

\maketitle
\begin{abstract}
\ari{The introduction and prelims should be ready for your eyes, as should be the main proof (almost)}
\end{abstract}

\section{Introduction}


\begin{figure}
	\includegraphics{assets/proof-system-relationships.pdf}
	\caption{The figure above (sourced from \citep[Page 10]{ProofComplexityLecNotes}) depicts proof systems commonly studied by the community and how they relate to each other.}
	\label{fig:example-proof-systems}
\end{figure}


Perhaps the most fundamental problem in computation is to provide an answer to the question: ``\textit{Given a true statement $A$, what is the shortest proof of the claim that $A$ is true?}''
In trying to answer this question, \citet{cook1979relative} observed that we must first describe what constitutes a valid proof?
That is, we must describe the language in which the proof is written, and the rules for checking it.
Each set of rules for writing and checking a proof defines a proof system.
Therefore, a precise restatement of the question above is the following:  ``\textit{Given a true statement $A$ and a proof system $S$, what is the length of the shortest proof $\Proof \in S$ that proves $A$?}''
If we could show that there exists a proof system $S$, such that for any true statement $A$, the length of the shortest proof in $S$ is upper bounded by some polynomial in the length of $A$, it would imply that $\CoNP = \NP$, which would further imply that $\P = \NP$.
Conversely, if we could show large proof size lower bounds for $A$ in all proof systems, it would lead to a formal proof of the widely believed conjecture that $\P \neq \NP$.
Unfortunately, we currently do not possess the tools to show lower such bounds for \emph{arbitrary} proof systems.
Thus, as an intermediate step towards making partial progress towards the grand problem, the research community has invested a significant amount of time and energy in proving size lower bounds for certain specific proof systems \citep{blake1937canonical,razborov1998lower, impagliazzo1999lower, alekhnovich2001lower, buss1999linear}.
\todo{Change this figure to the one in pitassi flemming which includes the relevant proof systems for us} Figure \ref{fig:example-proof-systems} lists some these proof systems and describes the relationships between them.
Proof systems listed at the top of Figure \ref{fig:example-proof-systems} are more expressive\footnote{Expressiveness is formalised by the notion of $p$-simulation, and we refer the reader to \citep[Definition 1.6]{ProofComplexityLecNotes} for more details.}, and lower bounds for such proof systems subsume claims about the complexity of proofs lower in the figure.
We refer the reader to \citep{krajicek2019proof, ProofComplexityLecNotesPaul} for more details on the definitions of the various proof systems.\par
%One example of a simple proof system is that of truth tables i.e. given a propositional formula $\PropFormula$ that is a tautology, a valid proof is simply the truth table for the formula.
%A formula on $n$ variables requires truth tables with size $2^n$, and it is easy to see that we cannot use shorter proofs.
%Although simple, truth tables are quite inefficient\footnote{A proof system $A$ is more inefficient than a proof system $B$ if proofs of the same claim are longer in $A$ compared to $B$.} proof systems, and there exists proof systems that can have much shorter proofs for certain problems than possible with truth tables.

In this work, we focus on the algebraic and semi-algebraic proof system of polynomial calculus (PC) \citep{alekhnovich2004pseudorandom} and sum of squares (SOS) proof system \citep{parrilo2000structured, boazCourse}.
In proof systems like PC and SOS, instead of a propositional formula over $n$ variables, we are given a set $\Axioms =\{\axiom_i(\vec{x}) \text{ } |\text{ } i \in [m] \}$ of $m$ polynomial equations\footnote{Semi-algebraic proof systems also allow for inequalities but we will not deal with inequality constraints in this paper.} over $n$ variables $\vec{x} = \{x_1, \dots, x_n\}$ as the problem instance.
In PC, the polynomial coefficients can be over \emph{any} field $\Field$, and in SOS, the polynomial coefficients must be over the reals.
We say a proof $\Proof$ is a refutation of $\Axioms$, if it is a proof of the claim (in the specified language) that there exists no assignment of $\vec{x} \in \Field^n$ that satisfies \emph{all} the polynomial equations in $\Axioms$. 
In PC and SOS, the proof $\Proof$ is itself expressed as a sequence of polynomials, and 
the size/complexity of the proof is measured by the maximum of degree of the proof polynomials that refutes $Q$ (see Section \ref{sec:proof-system-prelims} for more formal details).
We denote the minimum degree of a proof that refutes $\Axioms$ with $\Degree{\Axioms \PC \bot}$ and $\Degree{Q \SOS \bot}$ for PC and SOS respectively, and the main goal of the area is to study how large is the degree of proofs for refuting a given set of axioms $\Axioms$.
Although algebraic by definition, one can use these proof systems to refute properties of combinatorial objects like graphs, and it even serves as a proof system for UNSAT.\par
In this paper we consider refutations of the perfect matching principle.
More specifically, given an undirected graph $G=(V,E)$, and a vector $\vec{b} = (b_1, \dots, b_{|V|})  \in \Field^{\Size{V}}$, we define $\Card{G, \vec{b}}$ as the following set of polynomial constraints over variables $x_1, \dots, x_{|E|} \in \Field^{\Size{E}}$

\[
        \Card{G, \vec{b}}=
        \Bigger[10]\{\begin{array}{@{}cl}
                x_{\highlight{e}}(1 - x_{\highlight{e}}) = 0 & \text{ for every $\highlight{e} \in E$}\\[3mm]
                \underset{u \text{ is a neighbour of }\highlight{v}}{\sum x_{(u,\highlight{v})}}= b_{\highlight{v}} & \text{ for every $\highlight{v} \in V$} \\[3mm]
        \end{array}
\]

For every $e \in E$, if the polynomial equation $x_e(1 - x_e) = 0$ were to be satisfied, then it restricts the domain of the above variables to bits i.e. $x_e \in \bit$ for all $e \in E$.
Note if there was an assignment of variables in $\vec{x} \in \bit^{|E|}$ that satisfied all the equations in $\Card{G, 1^{|V|}}$, it would imply that the graph $G$ has a perfect matching (given by the edges corresponding to variables with assignment 1).  
When $\vec{b} = 1^{|V|}$, as short hand we denote $\Card{G, \vec{b}}$ as $\PM{G}$.
When $|V|$ is odd, we know that any graph $G$ cannot have a perfect matching.
In other words, $\Card{G, 1^{|V|}}$ cannot be satisfied.
In this work we are interested in the complexity refutations for $\PM{G}$  when $|V|$ is odd in PC and SoS proof systems.
With no further constraints on $G$, generic lower bounds for these refutations in PC or SOS proof systems are not known.
In their recent manuscript \citep[Open Problem 7.7]{buss2021proof}, Buss and Nordstr{\"o}m asked ``\textit{Are even colouring formulas over expander graphs hard for
polynomial calculus over fields of characteristic distinct from 2 ?}''
The even colouring formula is a special case of $\Card{G, \vec{b}}$, where each coordinate  $\vec{b}$ is $\degree{G}{v}/2$ for $v \in V$.
Therefore, their open question can be reformulated as the following question.

\begin{problem}

Do refutations for $\Card{G, \vec{b}}$ for
polynomial calculus over fields of characteristic $\neq 2$ have large size, when $G$ is an expander graph? \citep[Open Problem 7.7]{buss2021proof}

\end{problem}

\citet{Austrin_2022} made partial progress on the above problem by showing that the perfect matching principle requires large size on \emph{random $d$-regular graphs} (where $d \in \BigO{1}$) in the Sum-of-Squares and Polynomial Calculus proof systems \emph{on average}.
More formally, they show that 

\begin{theorem}\label{thm:prev-thm}
There is a constant $d_0 \in \Naturals$ such that for all $d \geq d_0$, and $\vec{b} \in [d]^{\Size{V}}$, the following holds \emph{asymptotically almost surely} over a random $d$-regular graph $G=(V,E)$ on $n$ vertices:
\begin{enumerate}
    \item{ $\Degree{\Card{G, \vec{b}} \PC \bot} = \BigOmega{\frac{n}{\log n}}$} 
    \item{$\Degree{\Card{G, \vec{b}} \SOS \bot} = \BigOmega{\frac{n}{\log n}}$}
\end{enumerate}
\end{theorem}

Given a random $d$-regular graph $G\samples \mathcal{G}(n, d)$ on $n$ vertices (where $n$ is odd), the authors start with a worst case hard graph $H$ described by \citet{buss1999linear}.
%Such a graph is known to have $\Degree{\PerfectMatching{G} \PC \bot} = \BigOmega{\Size{V(H)}}$ (see \citep[Appendix A]{Austrin_2022} for details about how $H$ is constructed and \citet{buss1999linear} for hardness proof).
Their average case hardness result then comes by \emph{embedding} $H$ into $G$ in such a way that that the hardness of $H$ is transferred to $G$.
Thus, the main contribution of \citet{Austrin_2022} is a novel embedding theorem that embeds $H$ as a topological minor into $G $ where edges in $H$ are mapped to odd length paths in the embedding.
A distinctive feature of their result is that as the embedding relies on randomness used to sample the regular graph, and thus they only provide average case lower bounds.
These techniques do not apply when the host graph $G$ is constructed deterministically, as in the case of the many known deterministic constructions of expander graphs.

\paragraph{Our Contribution} In this work, we directly answer Buss and Nordstr{\"o}m's question by showing hardness results that do \emph{not} rely on randomness, and therefore allowing us to prove worst case lower bounds for refuting perfect matchings in any large enough expander graph with an odd number of vertices.
It should be noted that as an expander graph is \emph{also} a random graph with high probability, our result subsumes the result of \citet{Austrin_2022}.
A second defining feature of our contribution is the qualitative simplicity of the hardness result.
To show their hardness results, Austrin and Risse embed the hard instance $H$ constructed by \citet{buss1999linear} in a random $d$ regular graph $G$.
To do this, they first show a partition lemma that partitions the vertices of $G$ into two sets $T$ and $\Vertices{G} \setminus T$, such that the partition satisfies two properties.
The first property requires that for any odd sized subset $U \subseteq T$, $\Vertices{G} \setminus U$ has a perfect matching.
This property is used to inherit the hardness of $H$ into $G$ (ensuring that there is no shorter refutation using parts of $G$ not used for the embedding).
%In contrast, we show a much simpler way to inherit the hardness of $H$ into any pseudo random graph (even deterministic constructions) via a simple application of the Tutte criterion (Lemma \ref{lemma:tutte-criterion}). 
The second property, requires the induced subgraph $G[T]$ contains a constant degree $\alpha$ vertex expander such that the maximal degree of $H$ is $\MaxDegree{H} \ll \alpha^2 \degree{}{G}$.
The primary reason the authors require the second property, is to be able to use a result by \citet{krivelevich2019completeminorsgraphssparse}, which allows us to embed any graph $H$ into a host graph $\tilde{G}$ as a minor, if $\tilde{G}$ is a vertex expander with the above properties.
%They describe an iterative algorithm for  embedding the vertices of $H$ into $\tilde{G}$ one while keeping track of the unused vertices of $\tilde{G}$, and discarding bad vertices that lead to bad embeddings and restarting the process of finding good vertices again \ari{Rajko can likely provide a better summary of his own work}.
However, Austrin and Risse cannot directly use the result in \citep{krivelevich2019completeminorsgraphssparse} as they need to embed $H$ as a \emph{topological} minor in a $d$-random graph $G$ instead of embedding it as an ordinary minor.
Thus, their main technical contribution is a modification of \citet{krivelevich2019completeminorsgraphssparse} to allow for topological embeddings.
To embed $H$ as a topological minor, Austrin and Risse need to find vertex disjoint odd length paths in $G$ for edges in $H$.
Therefore they map vertices of $H$ to ``star-like'' subgraphs in $G$, which allows the central vertex of the star to be connected to many vertex disjoint paths without incurring collisions.
Formally proving the result requires a fairly involved set of tools from spectral graph theory, and forms the basis of their main technical contribution.
In this work, we show a direct way to embed $H$ into any expander graph inspired by ideas from the theory of wide sense non blocking networks \citep{feldman1988wide}.
The only spectral graph theory we require is the expander mixing lemma (Lemma \ref{lemma:expanders-mixing-lemma}).
Furthermore, showing that the rest of graph contains a perfect matching, and therefore the hardness of $H$ is transferred, can be shown by a simple application of the Tutte criterion (Lemma \ref{lemma:tutte-criterion}).
In summary, we show \emph{stronger} lower bounds for a \emph{larger} set of objects using \emph{simpler} proof techniques.
Our main result is stated below.

\begin{theorem}[Main Theorem]\label{thm:main-thm}

There is constants $n_0, d_0 \in \Naturals$ such that for all $d \geq d_0$, the following holds  for \emph{any} $(n, d, \lambda)$-graph $G$ on $n \geq n_0$ vertices, where $n$ is odd and $\lambda < \highlight{TODO}$:
\begin{enumerate}
    \item{ $\Degree{\PerfectMatching{G} \PC \bot} = \BigOmega{\frac{n}{\log n}}$} 
    \item{$\Degree{\PerfectMatching{G} \SOS \bot} = \BigOmega{\frac{n}{\log n}}$}
\end{enumerate}

\end{theorem}

The rest of the document as is structured as follows. In section \ref{sec:prelims} we describe the requisite background from graph theory and proof complexity required to describe and derive the Theorem \ref{thm:main-thm}.
In Section \ref{sec:embed-machinery}, we review definitions and results from the theory of wide-sense nonblocking networks, which aid us in the construction of our main embedding theorem.
In Section \ref{sec:main-proof}, we provide the full proof of the main result and in Section \ref{sec:related-work} we describe related results in proof complexity lower bounds using embedding techniques.
Finally, in Section \ref{sec:conclusion} we conclude with some open problems that we could not resolve in this work.


\section{Preliminaries}
\label{sec:prelims}

We review some basic tooling used for proving existence of objects using the probabilistic method.
Detailed proofs for these lemmas can be found in \citep[Chapter 1, Chapter 7]{mitzenmacher2017probability}.
A dependency graph for a set of events $E_1, . . . , E_n$ is a graph $G=(V, E)$ such that $V = \{1,.. . , n\}$ and,  for $i= 1,\dots, n$, event $E_i$ is mutually independent
of the events $\{E_j | (i, j) \notin E\}$. The degree of the dependency graph is the maximum degree of any vertex in the graph.

\begin{lemma}[Lov\`asz Local Lemma]\label{lemma:lll}Let $\Dist \in \DistSet{\bit^*}$ be a discrete probability distribution over bit strings of finite length.
Let $E_1,...,E_n$ be a set of events, and assume that the following hold: (1) The degree of the dependency graph given by $(E_1, \dots, E_n)$ is bounded by $d$, and (2) $\PProb{E_i}{\Dist} \leq \beta$ for some $\beta \leq \frac{1}{4d}$. Then,

\[ \PProb{\overset{n}{ \underset{i=1}{\cap}} \hspace{0.1cm}  \overline{E_i}}{\Dist} > 0\]		
\end{lemma}

\begin{lemma}[Multiplicative Chernoff Bound]\label{lemma:mult-chernoff}
Suppose $X_1, ..., X_n$ are identical independent random variables taking values in $\{0, 1\}$. Let $X$ denote their sum and let $\mu = n\Mean{}{X_1}$ denote the sum's expected value. Then for any $0 < \delta < 1$

\[ \Prob{|X - \mu| \geq \delta \mu} \leq 2\exp(-\delta^2\mu/3)\]
	
\end{lemma}



\subsection{Graph Theory Preliminaries}
\label{sec:graph-theory-prelims}

For a graph $\Graph$, we use $\Vertices{\Graph}$ and $\Edges{\Graph}$ to denote the vertices and edges of $\Graph$. 
For any $E' \subseteq \Edges{\Graph}$ and a vertex $v \in \Vertices{\Graph}$, we use $\Neighbourhood{E'}{v} = \{ u \in \Vertices{\Graph} : (u,v) \in E' \}$ to denote the neighbourhood of $v$ with respect to $E'$, and $\degree{E'}{v}$ to denote the number of vertices adjacent to $v$ via edges in $E'$.
We assume the reader is familiar with standard graph theory definitions of subgraphs, minors, subdivisions and  topological minors.
We refer the reader to \citep{bollobas2012graph} for a detailed introduction to these concepts.
Next we define pseudorandom graphs or expander graphs. 
Throughout this document, it suffices to treat $d$ as a small constant.

\begin{definition}[$\EnDeeLambda$ pseudorandom graphs]\label{def:expander-graphs}
Let $G$ be a $d$-regular graph on $n$ vertices, and, let $\lambda_1 \geq \lambda_2, \dots, \geq \lambda_n$ denote eigenvalues of the adjacency matrix of $G$.
We say $G$ is an $\EnDeeLambda$-graph if $\ExpansionFactor{\Graph} \Def \underset{{\{2, \dots, n\}}}{\max}|\lambda_i| \leq \lambda$.
\end{definition}


\begin{lemma}[Expander Mixing Lemma]\label{lemma:expanders-mixing-lemma}
	
\end{lemma}





\subsection{Proof Complexity Preliminaries}
\label{sec:proof-system-prelims}

Let $\Axioms = \{ p_1 = 0, \dots, p_m = 0\}$ be a set of polynomial equations over variables $\vec{X} = \{x_1, \dots, x_n, \bar{x}_1, \dots, \bar{x}_n\}$, which we refer to as axioms.
We will always assume that the axioms $x_i^2 - x_i = 0$ and $\bar{x}_i^2 - \bar{x}_i = 0$ are always included in $\Axioms$ for all $i \in [m]$, which ensures that $x_i \in \bit$ for all $i\in [m]$.
Additionally, we will also assume that $1 - x_i - \bar{x}_i=0$ is also include for all $i \in [m]$, which ensures that the bar elements are bit complements of the non-bar elements.

\begin{definition}[Sum Of Squares Proofs]\label{def:sum-of-squares} Given a set of equality constraints $\Axioms$, a Sum of Squares (SoS) proof of $h \geq 0$ from $\Axioms$ is a set of polynomials $\Proof = (t_1, \dots, t_m; s_1, \dots, s_A)$ such that 

\[ \sum_{i \in [m]} t_ip_i+ \sum_{i \in [a]} s_i^2 = h\]

The degree of a proof $\Proof$ is 

\[ \Degree{\Proof} \Def \max\left\{\max_{i \in [m]} \Degree{t_i} + \Degree{p_i}, \max_{i \in [a]} 2\Degree{s_i}\right\}\]	


\end{definition}

Since we always assume the axioms contain constraints that restrict the variables to a boolean range by adding constraints $x_i^2 - x_i=0$ to the axioms, we can alternatively just work in the ring $\Field[x_1, \dots, \bar{x}_n]/(x_1^2 - x_1, \dots, \bar{x}_n^2 - \bar{x}_n)$ of multilinear polynomials.
Multi-linearity implies that the degree of any proof can be at most $n$ i.e a proof of degree $\BigOmega{n}$ is the largest lower bound one can hope to achieve.

\begin{definition}[SoS Refutation]
An SoS refutation of $\Axioms$ is a proof of $-1 \geq 0$ derived from an SoS proof from $\Axioms$. If we let $\Pi$ denote the set of all SoS refutations of $\Axioms$, then  

\[ \Degree{\Axioms \SOS \bot} \Def \min_{\Proof \in \Pi}\Degree{\Proof}\]
	
\end{definition}

Polynomial Calculus (PC) is a dynamic version of the static Nullstellensatz proof system \citep[Section 1.3]{fleming2019semialgebraic} based on the following inference rules.
\begin{enumerate}
	\item From polynomials $f=0$ and $g=0$ where $f,g \in \Field[\vec{X}]$ we can derive $\alpha f + \beta g = 0$ for $\alpha, \beta \in \Field$.
	\item From polynomail $f=0$ where $f \in \Field[\vec{X}]$, we can derive $xf=0$ where $x \in \vec{X}$.
\end{enumerate}

\begin{definition}[Polynomial Calculus Refutations]\label{def:poly-calc-refutations}
A Polynomial Calculus (PC) refutation of $\Axioms$ over is a set of polynomials $\Proof = t_1, \dots, t_l$	such that $t_l = 1$, and for each $i \neq l$, either (1) $t_i \in \Axioms$, or (2) $t_i$ is derived from $\{t_j\}_{j < i}$ using the above rules. 
The degree of the proof is given by $\Degree{\Proof} = \max_{i \in l}\Degree{t_i}$. If we let $\Pi$ denote the set of all PC refutations of $\Axioms$, then  

\[ \Degree{\Axioms \PC \bot} \Def \min_{\Proof \in \Pi}\Degree{\Proof}\]
\end{definition}

The following lemma is by \citet{buss1999linear} and gives an instance where perfect matching is hard to refute in the worst case.
\begin{lemma}[Worst Case Hard Instance For PC]\label{lemma:worst-case-instance}Given any odd $n \in \Naturals$, there exists a graph $H$ with $n$ vertices and maximum degree $\MaxDegree{H}= 5$ such that Polynomial Calculus over any field of characteristic different from 2 requires degree $\Theta(n)$ to refute $\Card{H, \vec{1}}$.
\end{lemma}

The lower bounds for this hard instance $H$ also carry over to SoS refutations, and a formal proof can be found in \citep[Theorem A.3]{Austrin_2022}.

\begin{lemma}[Worst Case Hard Instance For SOS]
Given any odd $n \in \Naturals$, there exists a graph $H$ with $n$ vertices and maximum degree $\MaxDegree{H}= 5$ such that SoS refutations requires degree $\Theta(n)$ to refute $\Card{H, \vec{1}}$.
\end{lemma}

An important lemma we will need is that given a set of axioms $\Axioms$ over the ring $\Field[x_1, \dots, x_n]$, a partial assignment of variables can only make refuting $\Axioms$ easier.
Given a set of $m$ polynomial equality constraints $\Axioms$ over boolean variables $\{x_1, \dots, x_n\}$, let the family of functions $\{f_i: \bit^n \rightarrow \{\True,\False\} \}_{i \in [m]}$, denote predicates for satisfiability for each constraint.
For example, given $\alpha \in \bit^n$, $f_i(\alpha) = \True$ if the $i$'th polynomial constraint $\axiom_i \in \Axioms$ is satisfied i.e $p_i(\alpha) = 0$.
We say $\Axioms$ is satisfied if $\exists \alpha \in \bit^n$ such that $f_i(\alpha) = \True \iff \axiom_i(\alpha)=0$ for all $i \in [m]$.
Given a map $\rho: \{x_1, \dots, x_n \} \rightarrow \{x_1, \dots, x_n, \bar{x}_1, \dots, \bar{x}_n, 1, 0 \}$, the restriction of a function $f: \bit^n \rightarrow \bit$, denoted by $f|_\rho$, is defined as $f|_\rho(x_1, \dots, x_n) = f(\rho(x_1), \dots, \rho(x_n))$.
Similarly, the restriction of formula $\Axioms$ is defined as $\Axioms|_\rho = \{f_{1}|_\rho, \dots, f_{m}|_\rho \}$.
Two formula $\Axioms$ and $\Axioms'$ are equivalent if they are element-wise equal, ignoring any functions that are constantly $\True$.
For example, $\Axioms = \{f_a, f_b, \True \}$ and $\Axioms' = \{f_a, f_b\}$ are equivalent, denoted as $\Axioms \equiv \Axioms'$.


\begin{definition}[Affine Restriction]\label{def:affine-restriction}
We say that an axiom $\Axioms'$ is an
affine restriction of $\Axioms$ if there is a map $\rho : \{x_1,\dots,x_n\} \rightarrow \{x_1, \dots, x_n, \bar{x}_1, \dots, \bar{x}_n, 1, 0 \}$ such that $\Axioms \equiv \Axioms|_{\rho}$.	
\end{definition}


\begin{lemma}\label{lemma:affine_restriction}
Let $\Axioms, \Axioms'$ be axioms such that $\Axioms'$ is an affine restriction of $\Axioms$, and each axiom
of $\Axioms$ depends on a constant number of variables, then 
\begin{enumerate}
	\item For any field $\Field$ it holds that $\Degree{\Axioms \PC \bot} \in \BigOmega{\Degree{\Axioms' \PC \bot}}$
	\item $\Degree{\Axioms \SOS \bot} \in \BigOmega{\Degree{\Axioms' \SOS \bot}}$
\end{enumerate}
\end{lemma}

The proof for the above lemma can be found in \citep[Lemma 2.2]{Austrin_2022}.
What the above lemma says is that if we have a graph $G$ with odd vertices, that has a perfect matching on a subset of even vertices on the graph, then the size of the proof to refute $\PM{G}$ is at least as large as refuting a perfect matching in $G$ with the even vertices removed.

%We are given a pseudorandom graph $G$ on an odd number of vertices for $n$ large enough, and we want to show that refuting perfect matchings in the PC and SoS proof system requires large proofs.
%As described earlier, we do this by topologically embedding the above hard instance $H$ into $G$ while preserving the hardness of the original instance.

\section{Embedding Machinery}
\label{sec:embed-machinery}
The following definitions are adapted from \citep{nenadov2023routing} but were originally introduced by \citet{feldman1988wide} in their work about the theory of wide sense blocking networks.

\begin{definition}[$(p, q)$-non blocking bipartite graphs]
Given $p,q \in \Naturals$ , we say that a bipartite graph $\Graph = (A \cup B, E)$ is $(p, q)$ \emph{non-blocking}, if there exists a family $\Family{S}$ of subsets of $E$, called the \emph{safe states}, such that the following holds:

\begin{enumerate}
	\item $\emptyset \in \Family{S}$
	\item If $E'' \subseteq E'$ and $E' \in \Family{S}$, \emph{then}, $E'' \in \Family{S}$.
	\item Given $E' \in \Family{S}$ such that $|E'| \leq p$, and \emph{any} $v \in A$ with $\degree{E'}{v} < q$, there exists $e = (v, w) \in E \setminus E'$  such that (i) $E' \cup \Set{e} \in \SafeStates $, and (ii) $w$ is not incident to any edge in $E'$ i.e. $\forall x \in A$ we have $(x,w) \notin E'$. 
 We call $w$ a \emph{safe neighbour} for $v$ given $E'$.
\end{enumerate}

\end{definition}


\begin{figure}[h]
\center
{\caption{The figure above demonstrates the third property of non blocking bipartite graphs $G=(L\cup R, E)$. As $E' \subseteq E$ is a safe state that is not too large, by the non blocking property, we are \emph{guranteed} to connect any vertex $v \in L$ to a vertex $w \in R$ such that $(v,w) \notin E'$}
}
\label{fig:test}
{\includegraphics{assets/non-blocking-networks.pdf}}
\end{figure}

Next, we re-state a lemma by \citep[Proposition 1]{feldman1988wide} which describes the properties bipartite graphs must satisfy to be non-blocking.

\begin{lemma}\label{lemma:condtions-for-non-block}
Fix $a, r, s \in \Naturals$. Let $\Graph = (A \cup B, E)$ be a bipartite graph.
If for every $X \subseteq A$ of size $1 \leq |X| \leq 2a$, there are \emph{at least} $(r + s)|X|$ vertices in $B$ that are adjacent to $A$, \emph{then}, $\Graph$ is $(r, as)$-non blocking.
\end{lemma}


\section{Proof Of Main Result}
\label{sec:main-proof}

Let $G=(V,E)$ denote any $\EnDeeLambda$-graph on an odd number of vertices, and,  $\HardInstance$ denote the hard instance on $t=\BigO{\frac{n}{\log n}}$ vertices for polynomial calculus known to exist as per Lemma \ref{lemma:worst-case-instance}.
The hardness proof follows from the following steps, and is illustrated in Figure \ref{fig:proof-outline}.


\begin{figure}
	\caption{Proof sketch}
	\label{fig:proof-outline}
\end{figure}

\begin{enumerate}
	\item First, we show (via Theorem \ref{thm:partition}) that we can partition the vertices of the graph $\Graph$ into two disjoint sets $A$ and $B$, as shown in Figure \ref{subfig:partitionA}. The partition has the property that for each vertex $v \in V$, $\Eps'd \leq |\Neighbourhood{E}{v} \cap A| \leq \Eps d$, where $0 <\Eps '< \Eps < 1$ are small universal constants. Given this partitioning, consider the subgraph $G_A = (A, E_A)$ where we only include edges with both endpoints in $A$ (see Figure \ref{subfig:partitionB}).
	\item Let $D = d/\ExpansionFactor{G} \in \Reals$. We find a subdivision $\Subdivision{H}{\sigma}$ of $H$, where for each $e \in \Edges{H}$, we have $\sigma(e) = \PathSize$, where $\PathSize = 2k+1$ is an odd integer for $k = \BigO{\log_{D} n}$. We show (via Theorem \ref{thm:top-embedding}) that $\Subdivision{H}{\sigma}$ is a subgraph of $G_A$ defined above. Let $\EmbeddingFunc: \Vertices{\Subdivision{H}{\sigma}} \rightarrow \Vertices{G_A}$ denote the topological embedding of $H$ into $G_A$, and $G_{\EmbeddingFunc}$ denote the subgraph of $G_A$ in which $H$ is topologically embedded. For each edge $(u,v) \in \Edges{H}$, let $\Path{u}{v}$ denote the vertex disjoint odd length path in $\Subdivision{H}{\sigma}$ we construct using Theorem \ref{thm:top-embedding}. Then it is at least as hard to refute\footnote{Note that this by itself does not guarantee it is hard to refute $\PM{G}$. We need item (3) and this to show hardness in refuting $\PM{G}$.} $\PM{G_{\EmbeddingFunc}}$ as it is to refute $\PM{H}$ . To see why, map each variable $y_e$ for $e \in \Path{u}{v}$ alternatingly to $x_{uv}$ or $\bar{x}_{uv}$, such that the edges adjacent to $u$ and $v$ are set to $x_{uv}$. This is always possible as $\Path{u}{v}$ is off odd length. Observe that this function maps a perfect matching formula  $\PM{G_{\EmbeddingFunc}}$ to $\PM{H}$. Therefore it should be at least as hard to refute $\PM{G_{\EmbeddingFunc}}$ as it is to refute $\PM{H}$.
	
	
%	\item Successfully executing the above steps guarantees that $\HardInstance$ exists inside of $\Graph$ as a topological minor. But as described earlier, this does not suffice in showing that $\PerfectMatching{\Graph}$ is also hard to refute. Let $\Embedding{\HardInstance}$ denote the vertices that form the topological embedding of $\HardInstance$ in $\Graph$. We want to show that the induced subgraph $\Graph[\Vertices{\Graph} \setminus \Embedding{\HardInstance}]$ contains a perfect matching. 
	\item We show (via Theorem \ref{thm:perfect-matching}) that the subgraph of $G$ not participating in the topological embedding above, has a perfect matching $M$. Define map $\rho: \{x_1, \dots, x_{|\Edges{G}|}\} \rightarrow \{x_1, \dots, x_{|\Edges{G}|}, \bar{x}_1, \dots, \bar{x}_{|\Edges{G}|}, 1, 0 \}$ such that 
	
	\[
        \rho(x_e)=
        \Bigger[10]\{\begin{array}{@{}cl}
                1 & \text{ if $e \in M \land e \notin \Edges{G_{\EmbeddingFunc}}$} \\
                0 & \text{ if $e \notin M \land e \notin \Edges{G_{\EmbeddingFunc}}$}\\ 
                x_e & \text{ otherwise} 
        \end{array}
\]

	If it easy to see that $\PM{G} \equiv \PM{G}|_\rho \equiv \PM{H}$. Therefore by Lemma \ref{lemma:affine_restriction} above, we get that $\PM{G} \in \BigOmega{|\Vertices{H}|} = \BigOmega{\frac{n}{\log n}}$.

\end{enumerate}

\subsection{Step 1: Partition $G$ into $A$ and $B$}

\ari{Change this to a balanced set -- look into Lemma by Killian and Per}

%\begin{figure*}[t!]
%    \centering
%    \begin{subfigure}[t]{0.5\textwidth}
%        \centering
%        \includegraphics{assets/ParitionA.pdf}
%        \caption{The figure above describes the partitioning of the vertices of the graph $G$ into two sets $A$ and $B$, such that for every vertex $v \in \Vertices{G}$, $\epsilon d$ fraction of the edges go into $A$ (depicted in orange) and $1 - \epsilon d$ fraction of the edges go into $B$.}
%    \end{subfigure}%
%    ~ 
%    \begin{subfigure}[t]{0.5\textwidth}
%        \centering
%        \includegraphics{assets/PartitionB.pdf}
%        \caption{The figures on top describes the subgraph $G_A$ obtained by including vertices in $A$, and only edges that stay inside $A$ (orange edges). The figure below describes how we construct a bipartite graph $\BipartiteG$ from $G_A$.}
%    \end{subfigure}
%%    \caption{Caption place holder}
%\end{figure*}

\begin{figure*}[t!]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{assets/ParitionA.pdf}
        \caption{The figure above describes the partitioning of the vertices of the graph $G$ into two sets $A$ (highlighted in green) and $B$ (highlighted in blue), such that for every vertex $v \in \Vertices{G}$, $\epsilon d$ fraction of the edges go into $A$ (depicted in orange) and $1 - \epsilon d$ fraction of the edges go into $B$.}
        \label{subfig:partitionA}
    \end{subfigure}%
    \hspace{1mm}
    \vrule width 1pt % vertical line
    \hspace{1mm}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{assets/PartitionB.pdf}
        \caption{The figures on top describes the subgraph $G_A$ obtained by including vertices in $A$ and edges that stay inside $A$ (orange edges), as described in the construction of Step 2. The figure below describes the bipartite graph $\BipartiteG$ we use for the embedding theorem.}
        \label{subfig:partitionB}        
    \end{subfigure}
\end{figure*}


\begin{theorem}[Partition Theorem]\label{thm:partition}
There exists a constant $d_0 \in \Naturals$ and small constants $\delta \in (0,1)$ such that, given a $\EnDeeLambda$ graph $\Graph = (V, E)$, with $d \in [d_0, n-1]$, there exists and a partition of $V$ into disjoint sets $A$ and $B$, such that, we have for every $v \in V$, $ \Eps'd \Def 0.1(1-\delta)d\leq |\Neighbourhood{\EdgesShort}{v} \cap A| \leq 0.1(1+\delta)d \Def \Eps d$. 
\end{theorem}

\begin{proof}We prove the existence of such a partition $A \cup B = V$ using the probabilistic method.
For each $v \in \Vertices{\Graph}$, we toss an independent coin $X_i$ with bias $\alpha=0.1$.
If $X_i = 1$, then we include $v$ in $A$, else we put $v$ in $B$.
Thus, $\vec{X} \Def (X_1, \dots, X_n) \in \bit^n$ is a random variable that describes how we partition $V$ into sets $A$ and $B$.
For any $v \in V$, let $Y_v = |\Neighbourhood{\EdgesShort}{v} \cap A| = \sum_{x \in \Neighbourhood{E}{v}} \Indicator{x \in A}$ denote the random variable that counts how many neighbours of $v$ are also in $A$.\\
For any $\delta \in (0,1)$ and for any $v \in V$, let $E_v = \Indicator{|Y_v - d\alpha | \geq \delta \alpha d}$ denote the bad event that $Y_v$ is bounded away from $\alpha d$ by a multiplicative factor of $\delta$.
As $\Graph$ is $d$-regular, $\Mean{\vec{X}}{Y_v} = \alpha d$, and observe that the dependency graph (Definition \ref{def:dep-graphs}) of events $\{ E_v \}_{v \in V}$ has max-degree at most $d$.
By the multiplicative Chernoff bound (Lemma \ref{lemma:mult-chernoff}), for any $v \in V$, we have $\PProb{E_v}{\vec{X}} \leq 2\exp(-\delta^2\alpha d/3) \Def \beta$.
For large enough $d$ i.e $d > d_0$, for some $d_0$, we have that $2\exp(-\delta^2\alpha d/3) \leq 1/(4d)$. Therefore, we have $\beta d \leq 1/4$.
Thus, we can invoke the Lov\`asz Local Lemma (Lemma \ref{lemma:lll}) to get $\PProb{\forall v \in V, \text{ } E_v = 0}{\vec{X}} > 0$.

\end{proof}

%Let $\tilde{\Graph} = A \cup B$ be the bipartite graph defined in the construction of Lemma \ref{lemma: bipartite-construct-non-block}.
%We know that this graph $(\pee, \qu)$ is non-blocking.
%Let $(a_1, \dots, a_k)$ denote an arbitrary ordering of arbitrary vertices in $A$.
%Set $E' = \emptyset$. 
%As $\tilde{\Graph}$ is non-blocking, there exists a collection of \emph{safe states} $\SafeStates$.


\subsection{Step 2: The Topological Embedding}

Given $\EnDeeLambda$ graph $G=(V,E)$, let $A$ and $B$ be the partition guaranteed by the \ \ref{thm:partition}.
We also have that for all $v \in A$,  

\[\alpha(1-\delta) d  \Def \EpsLower d \leq d |\Neighbourhood{\EdgesShort}{v} \cap A| \leq \alpha(1+\delta)d \Def \Eps d \]

Define $E_A \Def \{ (u,v) \in E : u \in A \land v \in A\}$. 
That is $E_A$ is the set of edges whose endpoints are fully contained in A (orange edges in Figure \ref{subfig:partitionA}), and let $G_A = (A, E_A)$. 
Define $ \na = |A|$.
Now define a bipartite graph $\BipartiteG = (V_A \cup V_A)$ such that if $(u,v) \in E_A$, then $(u,v) \in \Edges{\BipartiteG}$.

\begin{lemma}\label{lemma:bipartitie-is-non-blocking}Let $G$ be the $\EnDeeLambda$ graph given to us and let $\BipartiteG$ be the bipartite graph described above. 
There exists small constants $\epsilonL, \epsilonA  \in (0,1)$ independent of $d$ and $n$, such that if $\lambda < \epsilonL d$, then $\BipartiteG$ is $(\frac{d}{\lambda}, \epsilonA n)$ non-blocking.
\end{lemma}

\begin{proof}
Let $\BipartiteG = (X \cup Y, E_A)$. 
Let $\lambda = \ExpansionFactor{G} \leq d/c_2$ where $c_2 > 0$ is a constant to be defined later.
Set $a = \frac{n\lambda}{2c_1 d}$ for a constant $c_1 > 0$ to be defined later.
Set $c_1, c_2$ such that $\left(\frac{1}{c_1/2}  + \sqrt{\frac{1}{c_2/2}}\right) \leq \EpsLower$, where $\EpsLower$ is as defined in Theorem \ref{thm:partition}.
Pick any $S \subseteq X$ with $|S| \leq 2a = \frac{n\lambda}{c_1 d}$.
\highlight{Assume towards a contradiction, that there exists a set $T \subseteq Y$, such that 
$\CutEdges{S}{T}{E_A} < 2|S|\frac{d}{\lambda}$.} 
By how we constructed $\BipartiteG$, we know that
\[ \CutEdges{S}{T}{E_A} \geq \EpsLower d.\]

However, $S$ and $T$ are also subsets of $\Vertices{G}$ and $G$ is a $\EnDeeLambda$ graph.
From the \nameref{lemma:expanders-mixing-lemma}, we have

\begin{align}
	\CutEdges{S}{T}{E_A} &\leq \frac{d}{n}|S||T| + \lambda\sqrt{|S||T|} \\
	&< 2\frac{2d^2}{n\lambda}|S|^2 + |S|\sqrt{2\lambda d} \label{eq:assumption}\\
	&\leq |S|\left(\frac{2d^2}{\lambda n} \frac{n\lambda}{c_1 d} + \sqrt{d\cdot \frac{d}{c_2/2}}\right) \label{eq:assumption-lambda}\\
	&= |S|d\left(\frac{1}{c_1/2}  + \sqrt{\frac{1}{c_2/2}}\right) \\
	&\leq |S|d\EpsLower \label{eq:constants}
\end{align}


\eqref{eq:constants} is a contradiction, so our \highlight{assumption} must have been wrong.
\eqref{eq:assumption} comes from our \highlight{assumption}.
\eqref{eq:assumption-lambda} comes from our assumption that $\lambda \leq d/c_2$ and $|S| \leq \frac{n\lambda}{c_1 d}$.
Finally we get our theorem statement by setting $\epsilonL = 1/c_2$ and $\epsilonA = 1/c_1$.

%Let $X$ and $Y$ denote the left and right vertices of the bipartite graph $\BipartiteG$.
%Define $a = \epsilonA\cdot\frac{\lambda \na}{\dApproxLower}$.
%Fix $S \subseteq X$ such that $1 \leq |S| \leq 2a$.
%Suppose towards a contradiction, $G_A$ is \emph{not} non-blocking.
%Then by Lemma \ref{lemma:condtions-for-non-block}, for all $T \subseteq Y$, $\EdgesAccross{S, T}{E_A} \leq (2\dApproxLower/\lambda)|S|$.
%Pick $T^* \subseteq Y$ such that 
%
%\begin{equation}
%\EdgesAccross{S, T^*}{E_A} \geq |S|\dApproxLower	 \label{eq:lots-edges}
%\end{equation}
%
%We know $T^*$ exists as $G_A$ is $\dApproxLower$ regular.
%From the expander mixing lemma \ref{lemma:expanders-mixing-lemma},
%
%\begin{align}
%	\EdgesAccross{S, T^*}{E_A} &\leq \frac{\dApproxLower}{\na}|S||T^*| + \lambda\sqrt{|S||T^*|} \\
%	&\leq \frac{\dApproxLower^2}{\na \lambda}|S|^2 + |S|\sqrt{2\lambda \dApproxLower} \label{eq:stepa}\\
%	&< \frac{\dApproxLower^2}{\na \lambda}|S|^2 + |S|\dApproxLower\sqrt{2\epsilonL } \label{eq:stepb}\\
%	&\leq |S|\dApproxLower\left[ \frac{\dApproxLower|S|}{\na\lambda} + \sqrt{2\epsilonL}\right] \\
%	&\leq |S|\dApproxLower\left[ \frac{\epsilonA}{2} + \sqrt{2\epsilonL}\right] \label{eq:stepc}
%\end{align}
%
%
%For Equation \eqref{eq:stepa} We use that $\EdgesAccross{S, T^*}{E_A} \leq (2\dApproxLower/\lambda)|S|$. For Equation \eqref{eq:stepb} we use $\lambda < \epsilonL\dApproxLower$. For Equation \eqref{eq:stepc} we use $|S| \leq 2a$.
%Setting $\epsilonA$ and $\epsilonL$ small enough such that  $\frac{\epsilonA}{2} + \sqrt{2\epsilonL} < 1$, we get a contradiction with Equation \eqref{eq:lots-edges}.

\end{proof}


The next step is to topologically embed hard instance $H$ into the subgraph $G_A = (A, E_A)$.
Note for every edge in $E_A$, by our construction, we will have a corresponding edge in the bipartite graph $\BipartiteG$.

\begin{theorem}[Topological Embedding Theorem]\label{thm:top-embedding}
Let $G$ be a $\EnDeeLambda$ graph, and $\BipartiteG$ be the construction defined above, where $|A| = \na$.
Let $\dApproxLower \Def \Eps d$, and $H$ be the worst case hard instance on $t = \lceil\epsilonA \frac{\na}{\log \na}\rceil$ vertices, where $0 < \epsilonL < \epsilonA <1$ are the constants from  Lemma \ref{lemma:bipartitie-is-non-blocking}.	
\ari{Define $\sigma$}.
If $\lambda \leq \epsilonL d$, then $G$ contains $\Subdivision{H}{\sigma}$ as a subgraph.

\end{theorem}



\begin{proof}
Define $D = \frac{d}{\lambda}$ and $k \Def \lceil\log_D\na\rceil$.
Let $\{ h_1, \dots, h_t\}$ denote the vertices of $H$.
Let $\EmbeddingFunc: \Vertices{\Subdivision{H}{\sigma}} \rightarrow \Vertices{G_A}$ be the bijective mapping between the vertices of $\Subdivision{H}{\sigma}$, and the vertices of $G_A$, that defines our topological embedding.
Our first task is to find a unique $\Embedding{h} \in \Vertices{G_A}$ for each $h \in \Vertices{H}$.
Let $\{a_1, \dots, a_{t}\}$ be arbitrary set of $t$ vertices in $\Vertices{G_A}$.
We repeat the following process to obtain $\{ \Embedding{h_1}, \dots, \Embedding{h_t}\}$.
Let $X=\Vertices{G_A}$ and $Y=\Vertices{G_A}$ denote the left and right sides of the bipartite graph $\BipartiteG$ described above.
\ari{Add in some intuition as to why we need to do this}

\begin{figure*}[t!]
    \centering
    \begin{subfigure}[t]{0.95\textwidth}
        \centering
        \includegraphics{assets/embeddingA.pdf}
        \caption{The \textcolor{purple}{purple} edges represent the edges in $\cup_{i=1}^j (M_j \cup M_j')$, which we have already included in the $\GlobalEdgeSet$.
        For any $v$ in $S_j \subseteq X$ (\textcolor{cadmiumgreen}{green vertex}) we ask for $D$ neighbours in $S_{j+1} \subseteq Y$ (shown with \textcolor{cadmiumgreen}{green} and \textcolor{carminepink}{pink} lines). 
        Of these $D$ edges, by the non-blocking property, we know that there will be at least one edge (in this case there are 3 such edges shown in \textcolor{carminepink}{pink}) such that the endpoints in $Y$ are not connected to any of the \textcolor{purple}{purple} edges in $\GlobalEdgeSet$ . 
        The \textcolor{cadmiumgreen}{green} dotted edges are unsafe, so we cannot use them. We will add the safe \textcolor{carminepink}{pink} edges to $M_j$.}
        \label{subfig:embeddingA}
    \end{subfigure}%
    \hspace{1mm}
%    \vrule width 1pt % vertical line
    \hspace{1mm}
    \begin{subfigure}[t]{0.95\textwidth}
        \centering
        \includegraphics[]{assets/embeddingB.pdf}
        \caption{We restrict the size of $M_j$ to be $\min\{t, |S_{j-1}|D\}$ edges. As $k = \log_{D}[\na]$, eventually, for some $j \leq k$, we get $t \leq |S_{j-1}|D$.
        In the above example $M_{j-1}$ has size $D|S_{j-2}|$ but $M_j$ has size $t$. 
        From then on for all $j \leq i \leq k$, $|M_i|= t$.
        Furthermore, for $j \leq i \leq k$,  each vertex in $S_i$ will be connected to exactly one vertex in $S_{i+1}$ via a safe edge.
        }
        \label{subfig:embeddingB}        
    \end{subfigure}
\end{figure*}


\begin{itemize}
	\item Define $E' = \emptyset$ to begin with, and as $\BipartiteG$ is a $(D, \epsilonA n)$-non blocking bipartite graph (by Lemma \ref{lemma:bipartitie-is-non-blocking}), $E'$ is a \emph{safe} state.
	\item For $a_1 \in X$, we ask for $D$ neighbours in $Y$. By the non-blocking property, we can find a \emph{safe neighbour} $\tilde{h}_1 \in Y$ such that there is no edge in $E'$ is incident on $\tilde{h}_1$. We set $\Embedding{h_1} = \tilde{h}_1$ and update $E' = E'  \cup \{(a_1, \tilde{h}_1)\}$.
	\item We repeat this process for all $a \in \{a_2, \dots, a_t\}$. For the $j$'th step, As $|E'| = j \leq t < \epsilonA\na$, for each $a_j$ we can always find a \emph{safe neighbour} $\tilde{h}_j$ in $Y$ such that there is an edge from $a_j$ to $\tilde{h}_j$, and there is no other edge in $E'$ so far, that is incident on each $\tilde{h}_j$.
\end{itemize}

Once this phase is complete, we have mapped every vertex of $H$ to a vertex in $G_A$.
That is $\Embedding{h_i} = \tilde{h_i}$ for all $i \in [t]$.
The next step to show that for each $(u,v) \in \Edges{H}$, there is a vertex disjoint path of odd length $\PathSize = 2k+1$ between $\Embedding{u}$ and $\Embedding{v}$ in $G_A$.
Let $(e_1, \dots, e_m)$ be an arbitrary ordering of edges in $\Edges{H}$.
We prove the result by induction on $m$.

\paragraph{Base case} 

Let $e_1 = (u,v)$. Define sets $S_0 = \{\Embedding{u}\}$ and $S'_0 = \{ \Embedding{v}\}$, and set $M_0 = \emptyset$ and $M_0' = \emptyset$.
For each $z=1, \dots, k$, we will define edge sets $\{ M_j\}_{j \in [k]}$ and $ \{ M'_j\}_{j \in [k]}$, and vertex sets $\{ S_j\}_{j \in [k]}$ and $\{ S'_j\}_{j \in [k]}$ inductively as follows:

\begin{tcolorbox}
Fix $ 1 \leq z \leq k$, iteratively, let $M_z$ and $M'_z$ be the sets of $|S_z| \Def \min\{t, |S_{z-1}|D\}$ edges in $E_A$ incident to $S_{z-1}$ and $\S_{z-1}'$ respectively, such these edges are safe with respect to $\cup_{i=1}^{z} (M_i \cup M'_i)$.\\


More concretely, fix $1 \leq z \leq k$, and for each $v \in S_z \subseteq X$, we ask for $D$ neighbours in $S_{j+1} \subseteq Y$ via edges in $E_A$.
As $\BipartiteG$ is $(D, \epsilonA n)$ non-blocking, we know that at least one of these edges will be a safe edge connecting us to a safe neighbour in $S_{j+1}$, as long as $|\cup_{i=1}^{z} (M_i \cup M'_i)|$ is not too large.
Figure \ref{subfig:embeddingA} illustrates this.
Since $|M_i| \leq t$ and $|M_i'| \leq t$ for all $i \in [k]$, and $k = \log_D n$, we always have $\cup_{i=1}^{z} (M_i \cup M'_i)| \leq 2tk \leq \epsilonA n$.
If there are more than one safe edges for  vertices in $S_j$, consider at least one safe edge per vertex $v \in S_j$ to add to $M_j$ and, make sure $|M_j| = \min\{t, |S_{j-1}|D\}$.
Figure \ref{subfig:embeddingB} illustrates this idea.
$M'_j$ and $S_j'$ are constructed analogously.\\



\end{tcolorbox}

Let $M = \cup_{i=1}^k (M_i \cup M'_i)$.
The reason we can always construct the sets described above sets is that $|M| \leq tk < \epsilonA n$, and as $\BipartiteG$ is $(D, \epsilonA n)$ non-blocking, for any vertex $x \in S_j \subseteq X$, with at most $D$ neighbours in $S_{j+1} \subseteq Y$, we can always find \emph{at least} one $y \in S_{j+1}$, such that $(x,y) \in E_A$ and no edge in $\cup_{i=1}^{j-1} (M_i \cup M'_i)$ is incident on $y$.
Now as $k = \log_D[n]$, we have that, $|S_k| = |S_k'|= t$.
By the expander mixing lemma \ref{lemma:expanders-mixing-lemma},

\begin{align}
\CutEdges{S_k}{S_k'}{E_A}
 &\geq \frac{d t^2}{n} - \lambda t \\
	&> 0 \label{eq:greater}
\end{align}

Equation \eqref{eq:greater} comes from the assumption $\lambda \leq \epsilonL d$ (from Lemma \ref{lemma:bipartitie-is-non-blocking}).
This implies there exists at least one edge $e=(x,y)$ between $S_k$ and $S_k'$.
By how we constructed $M_k$, we know there is an edge $m_k = (a,x) \in M_k$ connecting $x$ to some vertex $a$ in $S_{k-1}$. 
Similarly, there is some edge $m_{k-1} \in M_{k-1}$ that connects $x$ to some vertex in $S_{k-2}$.
We repeat this process all the way, till we get $k+1$ edges, $m_1 m_2 \dots, m_k e$.
We repeat the same process for the other end point of $y \in S_k'$, to get edges $m'_1, \dots, m'_k$.
We add these edges to a global edge set $\GlobalEdgeSet$.
This gives is the situation depicted in Figure \ref{fig:baseB}.
Thus, we have found an odd length path $m_1\dots m_k e m_1'\dots m_k'$ of length $2k+1$, connecting $\Embedding{u}$ to $\Embedding{v}$.

\begin{figure}
	\includegraphics[width=0.9\textwidth
	]{assets/BaseA.pdf}
	\caption{In this toy example, $k=3$. The figure on top describes the forward phase of finding sets $\{M_i\}_{i\in [k]}$ and $\{M_i'\}_{i\in [k]}$. The figure below describes the process of backtracking from the edge $e$ that is promised to exist between $S_k$ and $S_k'$.}
	\label{fig:baseB}
\end{figure}



\paragraph{Induction Step}
	
Assume that we have found paths for $e_1 = (u_1, v_1), \dots, e_j=(u_j, v_j)$ for $j < m$.
Let $P_1, \dots, P_j$ denote these paths (depicted with \textcolor{carminepink}{pink} edges in Figure \ref{fig:induction}) .
Let $\GlobalEdgeSet$ denote the set of all edges in these paths.
Let $e_{j+1} = (u_{j+1},v_{j+1}) \in \Edges{H}$.
Set $S_0 = \{u_1, \dots, u_j\}$ and $S_0' = \{v_1, \dots, v_j\}$
Note that $\GlobalEdgeSet \leq tk \leq \epsilonA n$.
The process for finding a path between $u_{j+1}$ and $v_{j+1}$ reduces the base case, where now for any $1 \leq i \leq k$, for each node in $S_i$ and $S_i'$ we find a safe neighbour that does not have an incident  edge from $E' \cup (\cup_{i=1}^k (M_i \cup M'_i))$. As $|M| < \epsilonA\na$ as well, we are guaranteed safe neighbours exist for each node (depicted with \textcolor{purple}{purple} edges in Figure \ref{fig:induction})).
This concludes the proof.

\begin{figure}
	\includegraphics[width=0.9\textwidth
	]{assets/InductionStep.pdf}
	\caption{The figure above describes the induction step. The nodes in green are already in the embedding and represent paths $P_1, \dots, P_j$ for edges $(u_1, v_1) \dots, (u_j, v_j)$.
	The nodes in yellow represent candidates for the path for edge $u_{j+1}, v_{j+1}$. 
	The candidate nodes are constructed identical to the procedure described in the base step of the induction step, where we use the non-blocking property of $\BipartiteG$ to extend with safe neighbours. 
	}
	\label{fig:induction}
\end{figure}

	
\end{proof}

\subsection{Step 3: Finding A Perfect Matching In The Remainder Of The Graph}

Before describing the full proof need some definitions from graph theory.

\begin{definition}[Edge Connectivity]\label{def:edge-connectivity}
The edge connectivity of a graph $G$, denoted with $\EdgeConnectivity{G}$ is the minimum number of edges we must delete from the graph to make it disconnected.	
\end{definition}

\begin{lemma}[Edge Connectivity In Pseudorandom Graphs]\label{lemma:edge-connectivity-pseudorandom}
Every $\EnDeeLambda$ graph $G$ with $d - \lambda \geq 2$ has edge connectivity $\EdgeConnectivity{G} = d$.
\end{lemma}
\begin{proof}
  
\end{proof}

\begin{lemma}[Tutte Criterion]\label{lemma:tutte-criterion}
Let $\OddComponents{G}$ denote the number of odd sized connected components in a graph $G=(V,E)$ with even number of vertices.
$G$ admits a perfect matching \emph{if and only if} for every $S \subseteq V$, $\OddComponents{G[V \setminus S]} \leq |S|$.
\end{lemma}

\begin{lemma}[All Sets Are Good]\label{lemma:d-connected-sets-have-no-bad-sets}

\end{lemma}


\begin{theorem}[Perfect Matching On The Remainder Theorem]\label{thm:perfect-matching}
Given $\EnDeeLambda$ graph $\Graph=(V,E)$, let $\Embedding{\Subdivision{H}{\sigma}}$ be the topological embedding of the hard instance $H$ from Theorem \ref{thm:top-embedding}.
There exits a small constant $\PartitionEps \in (0,1)$, such that 
if $\ExpansionFactor{G} \leq d - \PartitionEps d - 2$, then the sub-graph $\Graph[V \setminus \Embedding{\Subdivision{H}{\sigma}}]$ has a perfect matching.	
	
\end{theorem}


\begin{proof}Let $\RemGraph \Def  \Graph[V \setminus \Embedding{\Subdivision{H}{\sigma}}]$.
  Let $A$ and $B$ denote the balanced sets from Theorem \ref{thm:partition}.
  In this proof, we describe vertices in $A$ as red nodes, and vertices in $B$ as green nodes.
  Assume towards a contradiction that $\RemGraph$ does \highlight{not} admit a perfect matching.
This implies that there exists a bad set $\BadSet$ such that $\OddComponents{\RemGraph \setminus \BadSet} > |\BadSet|$.
Now,  we know from Lemma \ref{lemma:edge-connectivity-pseudorandom} that $G$ is $d$ edge connected, therefore by Lemma \ref{lemma:d-connected-sets-have-no-bad-sets} we get that $\OddComponents{G \setminus \BadSet} \leq |\BadSet|$.  
Also as $\Embedding{\Subdivision{H}{\sigma}}$ is a connected subgraph contained entirely in $B$, it must be entirely contained in one of the connected components connected to $\BadSet$ (\highlight{See figure}).
We denote this connected component with $U$.
Now for $\RemGraph$ to \highlight{not} admit a perfect matching, deleting edges incident on $\Embedding{\Subdivision{H}{\sigma}}$ must cause $U$ to split into more than 1 disconnected components, which causes $\OddComponents{\RemGraph \setminus \BadSet}$ to cross over the threshold $|\BadSet|$ (\highlight{see figure}).
Without loss of generality, we assume that $\OddComponents{G \setminus \BadSet} = |\BadSet|$, and deleting $\Embedding{\Subdivision{H}{\sigma}}$ from $G$, splits $U$ into 2 disconnected components, and therfore we get 
$\OddComponents{\RemGraph \setminus \BadSet} =  |\BadSet|+1$, which implies $\BadSet$ is a bad set, and $\RemGraph$ does not admit a perfect matching.

\highlight{The picture looks like this --  use above figure for this}.

For $U$ to split at least two connected components, we need the scenario depicted by Figure \highlight{This is figure 2}.
Let us denote with $X$ and $Y$ the vertices of the components connected to $\Embedding{\Subdivision{H}{\sigma}}$.
If $U$ has to split into at least 2 components, there can be no edge between $X$ and $Y$.
But as $A$ and $B$ are balanced sets, and $G$ is an $\EnDeeLambda$ graph, \textit{we show that this is imppossible}, thereby giving us the contradiction we are looking for.

\end{proof}

\section{Related Work}
\label{sec:related-work}




\bibliographystyle{unsrtnat}
\bibliography{main_paper}
\clearpage
\appendix
\section{Extra Stuff TO SORT OUT later}
\subsection{Graph Theory Preliminaries}

\begin{definition}[Dependency Graphs]\label{def:dep-graphs}
	
\end{definition}




\begin{definition}[Subgraph]\label{def:subgraph}
A graph $G'=(V', E')$ is a subgraph of another graph $G=(V, E)$ iff (1) $V'\subseteq V$, and (2) $E'\subseteq E$ and  $(v_1, v_2) \in E' \implies (v_1, v_2) \in V')$.
	
\end{definition}

\begin{definition}[Sub-divisions]\label{def:subdivisions}
Given a graph $H$ and a function $\sigma: \Edges{H} \rightarrow \Naturals$, the $\sigma$-subdivision $H$, denoted by $\Subdivision{H}{\sigma}$, is the graph obtained by replacing each edge in $\Edges{H}$ with a path of length $\sigma(e)$ joining the end points of $e$ (such that all these paths are mutually vertex disjoint, except at the end points).	
\end{definition}

\begin{definition}[Topological Minor]\label{def:topological-minor}
A graph $H$ is a topological minor of a graph $G$ if there exists a subdivision $\Subdivision{H}{\sigma}$ that is isomorphic to \emph{any} subgraph of $G$.	
\end{definition}


\end{document}
